---
iteration_id: 2026-01-22-003
goal: "Unblock syncopation - improve syncopated zone syncopation metric"
status: failed
started_at: 2026-01-22T17:00:00Z
completed_at: 2026-01-22T18:00:00Z
branch: feature/iterate-2026-01-22-003
commit: pending
pr: pending
estimate_accuracy: 25
---

# Iteration 2026-01-22-003: Unblock Syncopation

## Goal

Improve the syncopated zone syncopation metric from 0.21 to target range 0.70-1.00.

## Baseline Metrics

From baseline v1.0.19:
- syncopated zone syncopation: 0.21 (target: 0.70-1.00)
- SHAPE=0.30: syncopation = 0
- SHAPE=0.50: syncopation = 0.83
- Pentagon Score: 61.0%
- Conformance: 84.7% (8/8 pass)

## Investigation

### Initial Hypothesis (INCORRECT)

Attempted to modify `algorithm_config.h`:
- kEuclideanFadeStart: 0.30 -> 0.20
- kSyncopationCenter: 0.50 -> 0.40

**Critical Discovery**: These config values only affect the `ComputeAlgorithmWeights()` function, which is ONLY used for debug output visualization in pattern_viz. They do NOT affect actual pattern generation!

The pattern generation uses:
1. **PatternField zones** - determines which weight generation algorithm is used
2. **BlendEuclideanWithWeights** - determines hit selection (euclideanRatio from GetGenreEuclideanRatio)

### Revised Hypothesis: PatternField Zone Alignment

Discovered that PatternField zones were misaligned with eval SHAPE zones:

| System | Stable | Syncopated | Wild |
|--------|--------|------------|------|
| Eval zones | 0.00-0.30 | 0.30-0.70 | 0.70-1.00 |
| PatternField (before) | 0.00-0.28 | 0.32-0.68 | 0.72-1.00 |
| PatternField (after) | 0.00-0.26 | 0.30-0.66 | 0.70-1.00 |

At SHAPE=0.30, the crossfade 1->2 zone extended to 0.32, meaning patterns were still blending stable/syncopation. Fixed by ending crossfade at exactly 0.30.

### Root Cause Analysis (Deep)

After zone alignment, SHAPE=0.30 still produces syncopation=0. Investigation revealed:

1. **Zone boundaries now aligned** - At SHAPE=0.30, PatternField enters Zone 2a (pure syncopation)
2. **GenerateSyncopationPattern IS being called** - verified via code trace
3. **But syncopation metric still = 0** - the weight field doesn't produce syncopation

The syncopation weight distribution is the bottleneck:
```cpp
// GenerateSyncopationPattern weights:
- Quarter notes: 0.80 weight
- 8th notes: 0.70 weight
- Weak offbeats: 0.35-0.55 weight
```

With Gumbel selection targeting ~7 V1 hits, the highest-weighted positions win. Quarter notes (0.80) always beat weak offbeats (0.35-0.55).

At SHAPE=0.50, syncopation=0.83 because the crossfade 2a->2b zone uses TWO different seeds, producing different hit positions that happen to include weak beats.

## Proposed Changes

Updated PatternField.h zone boundaries:
```cpp
// Before
kShapeZone1End = 0.28f;
kShapeCrossfade1End = 0.32f;
kShapeZone2bEnd = 0.68f;
kShapeCrossfade3End = 0.72f;

// After
kShapeZone1End = 0.26f;
kShapeCrossfade1End = 0.30f;
kShapeZone2bEnd = 0.66f;
kShapeCrossfade3End = 0.70f;
```

Also updated test_shape_blending.cpp to match new boundaries.

## Result Metrics

| Metric | Before | After | Delta |
|--------|--------|-------|-------|
| syncopated zone syncopation | 0.21 | 0.21 | 0% |
| SHAPE=0.30 syncopation | 0 | 0 | 0% |
| Pentagon Score | 61.0% | 60.9% | -0.1% |
| Conformance | 84.7% | 84.8% | +0.1% |
| All presets | 8/8 PASS | 8/8 PASS | - |
| All tests | 374 pass | 374 pass | - |

**Result**: Zone alignment had **no effect** on syncopation metric.

## Prediction Accuracy Analysis

| Aspect | Predicted | Actual | Error |
|--------|-----------|--------|-------|
| syncopation improvement | +10-20% | 0% | 100% |
| No regressions | yes | yes | 0% |

**Overall Estimate Accuracy**: 25% (direction wrong, mitigation correct)

## Lessons Learned

### What We Got Right
- Identified that eval zones and PatternField zones were misaligned
- Correctly aligned the zone boundaries
- No regressions in presets or tests

### What Surprised Us
- algorithm_config.h values don't affect generation, only debug output
- Zone alignment alone doesn't improve syncopation metric
- The syncopation weight field is designed for MODERATE syncopation
- Gumbel selection naturally favors higher-weighted positions

### Why Predictions Were Off
- Assumed zone alignment would change hit positions
- Didn't account for syncopation weight distribution design
- At SHAPE=0.30, syncopation weights still favor quarter notes (0.80) over weak offbeats (0.35-0.55)

### Root Cause Not Fixed
The syncopation metric remains blocked because GenerateSyncopationPattern is designed for moderate syncopation (per iteration 006 finding). To achieve high syncopation (0.70-1.00):

1. **Option A**: Increase weak offbeat weights significantly (0.80+)
2. **Option B**: Decrease quarter note weights significantly (0.40-)
3. **Option C**: Accept moderate syncopation at SHAPE=0.30-0.40 and revise eval targets
4. **Option D**: Add a "syncopation intensity" parameter for user control

### Critical Pattern Discovery
This iteration confirmed a pattern from iteration 006:

> "The syncopation ALGORITHM and syncopation METRIC both do what they're designed to do. The issue is that the EVAL TARGETS don't match the algorithm's design intent."

The algorithm produces **moderate syncopation** by design. Eval targets expect **high syncopation**. Zone alignment can't bridge this gap.

## Files Changed

1. `src/Engine/PatternField.h` - Updated zone boundary constants and struct defaults
2. `tests/test_shape_blending.cpp` - Updated test expectations for new boundaries

## Evaluation

- Target metric: 0% change FAIL (expected >=10%)
- Max regression: 0% PASS
- Tests: All 374 pass

## Decision

**FAILED** - Zone alignment did not improve syncopation metric. The root cause is the syncopation weight distribution in GenerateSyncopationPattern, not zone boundaries.

## Narration

This iteration attempted to "unblock" syncopation in the syncopated zone by aligning PatternField zone boundaries with eval SHAPE zones. The hypothesis was that at SHAPE=0.30 (the start of the syncopated zone), the PatternField was still in a crossfade zone, producing blended stable/syncopation weights instead of pure syncopation.

Initial investigation went down a wrong path, attempting to modify algorithm_config.h values. This revealed an important architectural insight: those config values only affect debug visualization output, not actual pattern generation. The generation is controlled by PatternField zones (for weight generation) and GetGenreEuclideanRatio (for hit selection blending).

After fixing the zone boundaries so SHAPE=0.30 enters pure syncopation mode, the syncopation metric remained at 0. Deeper investigation revealed why: the syncopation weight field itself doesn't produce high syncopation. Quarter notes get weight 0.80 while weak offbeats get 0.35-0.55. Gumbel selection naturally picks the highest-weighted positions, so hits still land on quarter notes.

The contrast with SHAPE=0.50 (syncopation=0.83) is interesting: that region uses a crossfade between two syncopation patterns with different seeds, which happens to produce hits on weaker metric positions. This suggests that the issue isn't zone alignment but rather the weight distribution itself.

This iteration confirms the finding from iteration 006: the syncopation algorithm is designed for moderate syncopation, but eval targets expect high syncopation. To truly unblock syncopation, we need to either modify GenerateSyncopationPattern weights or revise the eval target expectations.

## Remaining Issues

1. **Syncopation weight distribution**: GenerateSyncopationPattern favors quarter notes (0.80) over weak offbeats (0.35-0.55)
2. **Design intent mismatch**: Algorithm designed for moderate syncopation, targets expect high syncopation
3. **Option evaluation needed**: Determine whether to modify algorithm or targets

## Recommended Next Steps

1. **Investigation**: Analyze what makes SHAPE=0.50 produce high syncopation (seed blending effect)
2. **Option A - Algorithm change**: Modify GenerateSyncopationPattern to increase weak offbeat weights
3. **Option B - Target revision**: Accept that SHAPE < 0.40 produces moderate syncopation and revise targets accordingly
4. **Option C - New parameter**: Add syncopation intensity parameter for user control

The zone boundary changes should be kept as they correctly align PatternField with eval zones, even if they didn't improve syncopation.
