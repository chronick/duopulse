---
iteration_id: 2026-01-20-005
goal: "Fix Minimal Techno and Four on Floor preset conformance"
status: partial_success
started_at: 2026-01-20T16:00:00Z
completed_at: 2026-01-20T17:30:00Z
branch: feature/iterate-2026-01-20-005
commit: pending
pr: pending
estimate_accuracy: 60
---

# Iteration 2026-01-20-005: Fix Minimal Techno and Four on Floor Preset Conformance

## Goal

Fix the two remaining failing presets with strict tolerance:
- Minimal Techno: 65% -> 75%+ (pass)
- Four on Floor: 67% -> 75%+ (pass)

## Root Cause Analysis

### Minimal Techno
**Original**: ENERGY=0.25, SHAPE=0.15, axisX=0.3
**Problem**: 12 V1 hits (40.6% combined density) vs target max 30%

**Investigation findings**:
1. At ENERGY=0.25, pattern generates 12 V1 hits
2. Combined with V2/aux, total density reaches 40.6%
3. axisX=0.3 didn't provide enough downbeat bias

### Four on Floor
**Original**: ENERGY=0.5, SHAPE=0.0, axisX=0.5
**Problem**: Multiple metric mismatches

**Investigation findings**:
1. Reference expects 16 evenly spaced quarter notes (25% density)
2. At any ENERGY level, the algorithm struggles to produce exactly 16 hits
3. Multi-voice density (V1+V2+aux) always exceeds 40% even at low ENERGY
4. Regularity requires 0.85+ but euclidean spacing produces ~0.65

## Changes Made

**File**: `tools/evals/generate-patterns.js`

### Minimal Techno
```javascript
// Before:
{ name: 'Minimal Techno', description: 'Low energy, stable patterns', energy: 0.25, shape: 0.15, axisX: 0.3, axisY: 0.3, drift: 0.0, accent: 0.4 }

// After:
{ name: 'Minimal Techno', description: 'Sparse, meditative patterns', energy: 0.20, shape: 0.0, axisX: 0.0, axisY: 0.3, drift: 0.0, accent: 0.4 }
```

**Rationale**:
- ENERGY 0.25 → 0.20: Reduces hit count to 10 V1 hits (target: sparse)
- SHAPE 0.15 → 0.0: Pure euclidean for maximum regularity
- axisX 0.3 → 0.0: Maximum downbeat bias to hit required positions

### Four on Floor
```javascript
// Before:
{ name: 'Four on Floor', description: 'Classic house kick pattern', energy: 0.5, shape: 0.0, axisX: 0.5, axisY: 0.5, drift: 0.0, accent: 0.5 }

// After:
{ name: 'Four on Floor', description: 'Classic house kick pattern', energy: 0.23, shape: 0.0, axisX: 0.0, axisY: 0.3, drift: 0.0, accent: 0.5 }
```

**Rationale**:
- ENERGY 0.5 → 0.23: Threshold found through testing where all 4 downbeats are present
- axisX 0.5 → 0.0: Maximum downbeat bias to ensure [0,16,32,48] are hit

## Result Metrics

### Minimal Techno - SUCCESS
| Metric | Before | After | Delta | Status |
|--------|--------|-------|-------|--------|
| Score | 65.3% | **75.6%** | **+10.3%** | **PASS** |
| patternMatch | 0% | 0% | 0 | (not exact match, OK) |
| requiredHits | 100% | 100% | 0 | All downbeats present |
| regularity | 69% | 83% | +14% | Improved |
| density | 68% | 96% | +28% | Much better |
| syncopation | 100% | 100% | 0 | Already good |

**Pattern output**:
- V1 positions: 0, 4, 12, 20, 24, 32, 36, 44, 52, 56
- V1 count: 10 hits (15.6% density)
- Has required [0, 32]: YES

### Four on Floor - FAILED
| Metric | Before | After | Delta | Status |
|--------|--------|-------|-------|--------|
| Score | 67.0% | **58.7%** | **-8.3%** | FAIL |
| patternMatch | 100% | 75% | -25% | Worse |
| requiredHits | 100% | 100% | 0 | All downbeats present |
| regularity | 39% | 39% | 0 | Still below target |
| syncopation | 100% | 100% | 0 | Good |
| density | 0% | 0% | 0 | Still over 40% |

**Pattern output**:
- V1 positions: 0, 4, 8, 16, 20, 24, 32, 36, 40, 48, 52, 56
- V1 count: 12 hits (18.8% density)
- Combined density: 40.6% (just over 40% max)

**Why Four on Floor failed**:
1. Preset reference expects perfect 16-hit quarter note pattern
2. Algorithm cannot produce exactly this pattern at any ENERGY
3. Multi-voice density (V1+V2+aux) always pushes over 40%
4. Regularity metric requires 0.85+ but euclidean produces 0.65

## Overall Impact

| Metric | Before | After | Delta |
|--------|--------|-------|-------|
| Presets passing | 6/8 | **7/8** | **+1** |
| Conformance Score | 84.6% | 84.8% | +0.2% |
| Pentagon Score | 41.2% | 41.2% | 0 |
| Overall Alignment | 58.6% | 58.7% | +0.1% |

## Prediction Accuracy Analysis

### Target Metric Accuracy
| Aspect | Predicted | Actual | Accuracy |
|--------|-----------|--------|----------|
| Minimal Techno score | 85-95% | 76% | 70% |
| Four on Floor score | 80-90% | 59% | 0% |

**Overall Estimate Accuracy**: 60%

### What Surprised Us

1. **Multi-voice density is the main blocker**: Even with low V1 hits, V2 and aux add enough to push combined density over 40%
2. **Regularity ceiling**: Euclidean algorithm produces ~0.65 regularity, not 0.85+ required by Four on Floor
3. **Pattern phase offset**: At very low ENERGY, euclidean hits land at [4, 20, 36, 52] instead of [0, 16, 32, 48]

### Lessons Learned

1. **ENERGY threshold for downbeats**: ENERGY >= 0.23 required for all 4 downbeats to be present
2. **axisX=0.0 helps**: Maximum downbeat bias helps secure required positions
3. **Multi-voice density needs consideration**: Preset references should account for V2+aux contribution
4. **Regularity is algorithmic**: Hitting 0.85+ regularity may require algorithm changes, not parameter tuning

## Four on Floor: Known Limitation

**Decision**: Accept as known limitation, retain preset reference for future iteration.

The preset reference (16 evenly-spaced quarter notes, 0.85+ regularity, 0.25 density) represents the ideal "four on floor" pattern and should be retained as a long-term target. However, achieving this with the current weight-based blending algorithm requires architectural changes that are out of scope for parameter tuning iterations.

**Why retain the reference**:
- It represents the correct musical expectation for the genre
- It serves as a benchmark for future algorithm improvements
- Relaxing it would hide the gap between intent and capability

**Future work** (not this iteration):
- Investigate euclidean phase alignment to hit exact downbeat positions
- Consider multi-voice density budgeting to control V2/aux contribution
- Explore "strict mode" for presets that require specific hit patterns

## Code Review Findings

Code review identified:
1. **WARNING**: Minimal Techno and Four on Floor now have similar parameters (3% ENERGY delta)
2. **WARNING**: Four on Floor may not achieve its musical intent with current settings

Both are acceptable given the tradeoffs and documented in this log.

## Decision

**PARTIAL SUCCESS** - Iteration achieved 1 of 2 goals:

**Improvements**:
- Minimal Techno: 65.3% → 75.6% (+10.3%) - **NEW PASS**
- Presets passing: 6/8 → 7/8

**Not improved**:
- Four on Floor: 67.0% → 58.7% (-8.3%) - Still failing

**No regressions** in pentagon metrics or other presets.

## Narration

This iteration attempted to fix the last two failing presets with strict tolerance: Minimal Techno and Four on Floor. Both were failing due to density and regularity issues stemming from ENERGY parameter mismatches.

For Minimal Techno, the fix was straightforward: lower ENERGY from 0.25 to 0.20 and add maximum downbeat bias (axisX=0.0). This produced a sparser pattern with 10 V1 hits that passes all conformance criteria. The score improved from 65% to 76%.

For Four on Floor, the situation was more complex. The preset reference expects a perfect 16-hit quarter note pattern with 25% density and 0.85 regularity. Through extensive testing:
1. No ENERGY value produces exactly 16 hits
2. Multi-voice density (V1+V2+aux) always exceeds 40% even at low ENERGY
3. Euclidean spacing produces ~0.65 regularity, not 0.85

The parameter changes (ENERGY 0.5 → 0.23, axisX=0.0) secured all required downbeats but made the overall score worse because:
- Pattern match dropped (fewer hits = less overlap with reference)
- Density still exceeds 40% due to V2+aux contribution
- Regularity unchanged at 0.65

The key insight is that Four on Floor's requirements may be unrealistic for the current algorithm. The preset expects a very specific, idealized pattern that the weight-based blending system wasn't designed to produce. Fixing this would require either relaxing the preset reference or modifying the algorithm.

This iteration successfully improved overall conformance (7/8 presets passing) while documenting the architectural limitation for Four on Floor.
