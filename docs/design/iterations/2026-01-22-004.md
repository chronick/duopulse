---
iteration_id: 2026-01-22-004
goal: "Unblock syncopation - modify GenerateSyncopationPattern weights (Option A)"
status: failed
started_at: 2026-01-22T17:35:00Z
completed_at: 2026-01-22T18:45:00Z
branch: feature/iterate-2026-01-22-004
commit: pending
pr: pending
estimate_accuracy: 5
---

# Iteration 2026-01-22-004: Unblock Syncopation via Weight Changes

## Goal

Following iteration 003's recommendation (Option A), modify GenerateSyncopationPattern to increase weak offbeat weights so they can compete with/beat quarter note weights in Gumbel selection.

Target: Improve syncopated zone syncopation from 0.21 to 0.70+ range.

## Baseline Metrics

From baseline v1.0.0:
- syncopated zone syncopation: 0.21 (target: 0.70-1.00)
- SHAPE=0.30 syncopation: 0
- SHAPE=0.50 syncopation: 0.74
- Pentagon Score: 60.9%
- Conformance: 84.8% (8/8 pass)

## Investigation

### Phase 1: Weight Changes (Attempted)

Modified GenerateSyncopationPattern weights:
```cpp
// Before → After
Weak offbeats:   0.35-0.55 → 0.75-0.95 (+115%)
Anticipation:    0.40-0.60 → 0.70-0.90 (+55%)
Quarter notes:   0.80 → 0.55 (-31%)
8th notes:       0.70 → 0.50 (-29%)
Downbeats:       0.90-1.00 → 0.50-0.70 (-40%)
```

**Result**: syncopated zone syncopation improved +2.76% (0.215 → 0.221), but regularity regressed -3.74%.

### Phase 2: Euclidean Ratio Investigation

Discovered that the evaluation runs at ENERGY=0.5, which places patterns in BUILD zone:
```cpp
inline EnergyZone GetEnergyZone(float energy)
{
    if (energy < 0.20f) return EnergyZone::MINIMAL;
    if (energy < 0.50f) return EnergyZone::GROOVE;  // <-- NOT this (0.50 is not < 0.50)
    if (energy < 0.75f) return EnergyZone::BUILD;   // <-- This!
    return EnergyZone::PEAK;
}
```

And in GetGenreEuclideanRatio:
```cpp
// Only active in MINIMAL and GROOVE zones
if (zone != EnergyZone::MINIMAL && zone != EnergyZone::GROOVE)
    return 0.0f;  // <-- BUILD zone returns 0 (no Euclidean)
```

**Key Finding**: At ENERGY=0.5, Euclidean blending is ALREADY DISABLED. The patterns should be using pure Gumbel selection with syncopation weights. But syncopation is still low.

### Phase 3: Pattern Analysis

Analyzed V1 hits at SHAPE=0.30, ENERGY=0.5:
- Steps: 0, 2, 4, 8, 14, 20, 26
- Metrics: 1.00, 0.25, 0.50, 0.80, 0.25, 0.50, 0.25

3 syncopated hits (steps 2, 14, 26 at metric 0.25) but 4 non-syncopated hits (steps 0, 4, 8, 20 at metric 0.50-1.00).

The weight changes didn't shift the balance enough because:
1. The pattern is **deterministic** - same seed produces same pattern
2. Gumbel selection with specific seed favors certain positions regardless of weight distribution
3. Weight changes need to be MORE dramatic to overcome seed-based positioning

### Phase 4: Revert and Document

Reverted changes due to:
1. Minimal improvement (+2.76%)
2. Regressions in regularity (-3.74%)
3. Root cause not addressed

## Prediction Accuracy Analysis

| Aspect | Predicted | Actual | Error | Accuracy |
|--------|-----------|--------|-------|----------|
| syncopated zone syncopation | +40-60% | +2.76% | ~95% | 5% |
| regularity regression | -5-10% | -3.74% | ~40% | 60% |
| SHAPE=0.30 syncopation | 0→0.50-0.80 | 0→0 | 100% | 0% |

**Overall Estimate Accuracy**: 5% (predictions fundamentally wrong)

## Root Cause Analysis

The syncopation metric at SHAPE=0.30 remains at 0 because:

1. **Weight field alone doesn't determine hit positions** - The Gumbel sampler adds seed-based randomness that can override weight preferences

2. **ENERGY=0.5 is in BUILD zone** - No Euclidean blending occurs (ratio=0), so weight changes should theoretically affect patterns, but...

3. **Gumbel selection seed effects dominate** - The HashToFloat(seed, step) perturbation in Gumbel selection creates deterministic "preferences" for certain steps that persist across weight changes

4. **SHAPE=0.30 is at the Zone 2a boundary** - Just entering syncopation zone, weights are pure syncopation but the seed-based selection happened to favor strong metric positions

5. **Why SHAPE=0.50 works**: The crossfade 2a→2b zone blends TWO syncopation patterns with DIFFERENT seeds (seed and seed+0x12345678). This creates enough variation that some hits land on weak beats.

## Lessons Learned

### What We Got Right
- Correctly identified GenerateSyncopationPattern as the weight source
- Correctly identified that Euclidean ratio is 0 at ENERGY=0.5

### What Surprised Us
- Weight changes of +115% only produced +2.76% metric improvement
- The Gumbel sampler's seed-based randomness has more influence than weights
- Pattern determinism means same seed → same pattern regardless of weight distribution (within reasonable changes)

### Why Predictions Were Off
- Assumed weight hierarchy changes would directly translate to hit position changes
- Didn't account for Gumbel sampler's seed-based determinism
- The syncopation improvement from SHAPE=0.50 comes from seed blending, not weight distribution

### Critical Pattern Discovery

The syncopation metric improvement at SHAPE=0.50 comes from the **dual-seed crossfade**, not from the syncopation weight distribution:

```cpp
// Zone 2a (SHAPE=0.30): single seed
GenerateSyncopationPattern(energy, seed, patternLength, outWeights);

// Crossfade 2a→2b (SHAPE=0.50): dual seeds blended
GenerateSyncopationPattern(energy, seed, patternLength, syncopationWeights);
GenerateSyncopationPattern(energy, seed + 0x12345678, patternLength, stableWeights);
// Then lerp between them
```

This suggests the real fix is not weight distribution but **hit position diversity**.

## Files Changed

None - changes reverted due to failure.

## Evaluation

- Target metric: +2.76% FAIL (expected >=30%)
- Regressions: -3.74% regularity FAIL (>2%)
- Tests: All pass

## Decision

**FAILED** - Weight changes alone cannot overcome Gumbel seed determinism.

## Recommended Next Steps

### Option 1: Dual-Seed Approach for Zone 2a
Extend the dual-seed blending to Zone 2a (SHAPE 0.30-0.48):
```cpp
// Instead of single-seed:
if (shape < config.shapeZone2aEnd)
{
    // Zone 2a: Blend TWO syncopation patterns (like 2a→2b crossfade does)
    GenerateSyncopationPattern(energy, seed, patternLength, syncopationWeights);
    GenerateSyncopationPattern(energy, seed + 0x87654321, patternLength, altWeights);
    // Blend with t = (shape - 0.30) / (0.48 - 0.30)
}
```

### Option 2: Seed-based Position Rotation
Add seed-dependent rotation BEFORE Gumbel selection:
```cpp
int baseRotation = HashToFloat(seed, 5000) * 4;  // 0-3 steps rotation
// Apply to weight array before Gumbel selection
```

### Option 3: Accept Design Intent
The syncopation algorithm is designed for **moderate** syncopation at SHAPE=0.30. The target of 0.70+ may be unrealistic for this SHAPE range. Consider revising eval targets.

### Option 4: New Syncopation Algorithm
Create `GenerateHighSyncopationPattern()` for SHAPE > 0.30 that ONLY allows hits on weak 16th note positions (kSyncopationMask).

## Narration

This iteration attempted to "unblock" syncopation by increasing weak offbeat weights in GenerateSyncopationPattern, following Option A from iteration 003. The hypothesis was that giving weak offbeats higher weights (0.75-0.95) than quarter notes (0.55) would cause Gumbel selection to favor weak beats.

The attempt failed for an unexpected reason: weight changes don't significantly affect hit positions when using the Gumbel sampler with deterministic seeds. The seed-based randomness in Gumbel selection creates "preferred" positions that persist across reasonable weight distribution changes.

The investigation revealed WHY SHAPE=0.50 produces high syncopation while SHAPE=0.30 does not: SHAPE=0.50 falls in the crossfade 2a→2b zone, which blends TWO syncopation patterns with DIFFERENT seeds. This dual-seed approach creates enough variation that hits land on diverse metric positions, including weak beats.

The key insight is that syncopation improvement requires **position diversity**, not just weight redistribution. Future iterations should focus on extending the dual-seed approach to Zone 2a, or accepting that moderate syncopation is the design intent for SHAPE < 0.50.
