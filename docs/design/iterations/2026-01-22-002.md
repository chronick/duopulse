---
iteration_id: 2026-01-22-002
goal: "Fix Minimal Techno preset regression caused by Four on Floor fix"
status: success
started_at: 2026-01-22T16:30:00Z
completed_at: 2026-01-22T16:45:00Z
branch: feature/iterate-2026-01-22-002
commit: pending
pr: pending
estimate_accuracy: 95
---

# Iteration 2026-01-22-002: Fix Minimal Techno Preset

## Goal

Fix the Minimal Techno preset which was failing conformance at 64% (threshold: 75%) after the Four on Floor fix in iteration 2026-01-22-001.

## Baseline Metrics (Before)

From baseline v1.0.19:
- Minimal Techno conformance: 64% FAIL
- V1 hits: 16 (expected: ~5-6 for sparse pattern)
- Presets passing: 7/8
- Conformance score: 82.8%

## Investigation

### Root Cause Analysis

The Four on Floor fix (iteration 2026-01-22-001) added a condition:

```cpp
if (shape <= 0.05f) {
    int quarterNoteCount = patternLength / 4;
    return std::max(euclideanK, quarterNoteCount);
}
```

This forces 16 hits (quarter notes) for ANY pattern with SHAPE <= 0.05, regardless of ENERGY. This is correct for Four on Floor (ENERGY=0, SHAPE=0) but wrong for Minimal Techno (ENERGY=0.20, SHAPE=0) which should be sparse.

The distinction between these presets is the ENERGY parameter:
- **Four on Floor**: ENERGY=0.0, SHAPE=0.0 - wants 16 quarter-note hits
- **Minimal Techno**: ENERGY=0.20, SHAPE=0.0 - wants ~5-6 sparse euclidean hits

## Proposed Changes

Add ENERGY check to the four-on-floor condition:

```cpp
// Before
if (shape <= 0.05f) {
    int quarterNoteCount = patternLength / 4;
    return std::max(euclideanK, quarterNoteCount);
}

// After - only activate for true Four on Floor patterns
if (shape <= 0.05f && energy <= 0.05f) {
    int quarterNoteCount = patternLength / 4;
    return std::max(euclideanK, quarterNoteCount);
}
```

## Estimates (Prediction Phase)

### Predicted Impact

**Target Metric**: Minimal Techno conformance
- Predicted: +15-20% improvement (64% -> 79-84%)
- Confidence: HIGH (90%)

**Secondary Effects**:
- Four on Floor: Expected 0% change
- Other presets: Expected 0% change
- Pentagon score: Possible +1-3% improvement

**Risks Identified**:
- Regression risk: LOW
- Potential regressions: Four on Floor if condition too restrictive

## Result Metrics

### Minimal Techno (After Fix)
| Metric | Before | After | Delta |
|--------|--------|-------|-------|
| Conformance | 64% | 79% | **+15%** |
| V1 hits | 16 | 8 | -8 |
| Status | FAIL | **PASS** | Fixed |

### Overall Metrics
| Metric | Before | After | Delta |
|--------|--------|-------|-------|
| Pentagon Score | 59.4% | 61.0% | +1.6% |
| Conformance | 82.8% | 84.7% | +1.9% |
| Presets Pass | 7/8 | **8/8** | +1 |
| Overall Alignment | 68.8% | 70.5% | +1.7% |

### All Preset Conformance (After)
| Preset | Score | Status |
|--------|-------|--------|
| Minimal Techno | 79% | PASS |
| Four on Floor | 80% | PASS |
| Driving Techno | 76% | PASS |
| Syncopated Groove | 100% | PASS |
| Broken Beat | 94% | PASS |
| Chaotic IDM | 82% | PASS |
| Sparse Dub | 77% | PASS |
| Dense Gabber | 89% | PASS |

## Prediction Accuracy Analysis

### Target Metric Accuracy
| Aspect | Predicted | Actual | Error | Accuracy |
|--------|-----------|--------|-------|----------|
| Minimal Techno | 79-84% | 79% | 0% | 100% |
| Four on Floor | unchanged | unchanged | 0% | 100% |

### Secondary Metrics Accuracy
| Metric | Predicted | Actual | Error | Accuracy |
|--------|-----------|--------|-------|----------|
| Pentagon | +1-3% | +1.6% | 0% | 100% |
| No regressions | yes | yes | 0% | 100% |

**Overall Estimate Accuracy**: 95%

## Lessons Learned

### What We Got Right
- Identified the Four on Floor fix as the root cause immediately
- Predicted the fix correctly (add ENERGY check)
- Predicted the impact accurately (+15%)

### What Surprised Us
- Nothing - this was a straightforward fix once the root cause was identified

### Why Predictions Were Off
- They weren't - this iteration had near-perfect prediction accuracy

### Implications for Future Iterations
- When fixing one preset, always test that related presets (same parameter space) aren't broken
- The ENERGY and SHAPE parameters are independent - conditions should check both when appropriate
- "Pure euclidean mode" should be defined as SHAPE <= 0.05 AND ENERGY <= 0.05, not just SHAPE alone

## Files Changed

1. `src/Engine/HitBudget.h` - Added energy parameter to ComputeEffectiveHitCount
2. `src/Engine/HitBudget.cpp` - Added energy check to four-on-floor condition
3. `tests/test_generation.cpp` - Updated tests for new function signature

## Evaluation

- Target metric: +15% PASS (exceeded 5% threshold)
- Max regression: 0% PASS (no regressions)
- Tests: All 374 pass

## Decision

**SUCCESS** - Minimal Techno conformance improved from 64% to 79%, now PASS. All 8 presets now pass conformance.

## Narration

This iteration fixed a regression introduced by the Four on Floor fix from earlier today. The previous fix added a condition that forces 16 quarter-note hits when SHAPE <= 0.05, which was correct for Four on Floor but broke Minimal Techno.

The root cause was that the condition only checked SHAPE but not ENERGY. Four on Floor uses ENERGY=0 (maximum sparsity baseline) while Minimal Techno uses ENERGY=0.20 (still sparse, but not maximum). By adding an ENERGY <= 0.05 check, the quarter-note floor now only activates for true Four on Floor patterns.

With this fix, all 8 presets now pass conformance, achieving the goal of 8/8 preset compliance for the first time since the baseline was established.

This iteration demonstrates the importance of testing related presets when making algorithm changes that affect shared parameter ranges.
