---
iteration_id: 2026-01-19-003
goal: "Improve regularity in stable zone (0.56 -> 0.72+)"
status: failed
started_at: 2026-01-20T02:00:00Z
completed_at: 2026-01-20T02:30:00Z
branch: feature/iterate-2026-01-19-003
commit: pending
pr: pending
estimate_accuracy: 0
---

# Iteration 2026-01-19-003: Improve Regularity in Stable Zone

## Goal

Improve regularity in stable zone from 0.56 to target range 0.72-1.00.

This was a retry of the same goal from iteration 2026-01-19-002, which failed due to using a SHAPE-domain lever (kEuclideanFadeEnd) for an ENERGY-defined zone. This iteration used an ENERGY-domain lever (kAnchorKMin) to correctly target the stable zone.

## Baseline Metrics (Before)

| Metric | Stable Zone | Target |
|--------|------------|--------|
| regularity | 0.5581 | 0.72-1.00 |
| density | 0.5938 | 0.15-0.32 |
| voiceSeparation | 0.8947 | 0.62-0.88 |
| syncopation | 0.00 | 0.00-0.22 |

## Lever Analysis

**Previous failure (2026-01-19-002)**: Used kEuclideanFadeEnd (SHAPE lever) for ENERGY zone - domain mismatch.

**This iteration**: Used kAnchorKMin (ENERGY lever) for ENERGY zone - correct domain.

Bootstrap heuristic confidence: 5/5 (Stable Zone Tightness recommends kAnchorKMin)

Design-critic recommended pivot from kAuxKMin to kAnchorKMin for more direct effect.

## Estimates (Prediction Phase)

### Predicted Impact

**Target Metric**: regularity (stable zone)
- Predicted: +3-8% improvement (0.56 -> 0.58-0.60)
- Confidence: MEDIUM-LOW (40%)

**Secondary Effects**:
- stable zone density: Predicted -5-10% (beneficial - above target)
- stable zone syncopation: Predicted 0%
- voiceSeparation: Predicted no significant change

**Risks Identified**:
- Voice separation might decrease if anchor too sparse
- Effect may be smaller than predicted due to euclidean inherent regularity

## Proposed Changes

```cpp
// inc/algorithm_config.h
kAnchorKMin: 4 -> 3 (-25%)
```

Rationale: At low ENERGY (stable zone), anchor patterns use k closer to kAnchorKMin. Reducing from 4 to 3 creates sparser anchor patterns, hypothesis was this would increase regularity.

## Result Metrics (After)

| Metric | Before | After | Delta | % Change |
|--------|--------|-------|-------|----------|
| **regularity** | 0.5581 | 0.5515 | -0.007 | **-1.2%** |
| density | 0.5938 | 0.5000 | -0.094 | -15.8% |
| voiceSeparation | 0.8947 | 0.9375 | +0.043 | +4.8% |
| syncopation | 0.00 | 0.00 | 0 | 0% |

**Note**: Syncopation metric shows 0 across all zones due to a separate bug - pattern length changed to 64 steps but metric weights are only defined for 32. This is a pre-existing issue unrelated to this iteration.

## Prediction Accuracy Analysis

### Target Metric Accuracy

| Aspect | Predicted | Actual | Error | Accuracy |
|--------|-----------|--------|-------|----------|
| regularity | +3-8% | -1.2% | +4.2-9.2% | **0%** |

Direction was wrong - predicted improvement, got regression.

### Secondary Metrics Accuracy

| Metric | Predicted | Actual | Error | Accuracy |
|--------|-----------|--------|-------|----------|
| density | -5-10% | -15.8% | -5.8% | 55% |
| voiceSeparation | ~0% | +4.8% | -4.8% | 0% |

**Overall Estimate Accuracy**: 0% (target prediction failed completely)

## Lessons Learned

### What We Got Right

1. Domain matching: Used ENERGY lever for ENERGY zone (correct approach)
2. Density direction: Correctly predicted density would decrease
3. Test hygiene: Updated hardcoded test values to use config constants

### What Surprised Us

1. **Regularity decreased, not increased**
   - euclidean(16, 3) has uneven gaps [1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0]
   - euclidean(16, 4) has even gaps [1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0]
   - More hits with even spacing = higher regularity

2. **Voice separation increased unexpectedly**
   - Sparser anchor created more gaps for shimmer to fill
   - This accidentally improved voice separation

### Why Predictions Were Off

1. **Flawed hypothesis**: Assumed "sparser = simpler = more regular"
   - Reality: Regularity measures gap uniformity, not sparseness
   - euclidean(n, k) with k dividing n evenly produces most regular patterns

2. **Bootstrap heuristic misleading**: Heuristic said kAnchorKMin affects "stable zone tightness" with 5/5 confidence, but this doesn't mean it improves regularity

3. **Metric definition confusion**: "Regularity" doesn't mean "sparse" or "simple" - it means "evenly-spaced gaps"

### Implications for Future Iterations

1. **Regularity is about gap uniformity**: To improve regularity, need patterns where gaps between hits are equal. euclidean(16, k) where 16/k is an integer (k=1,2,4,8,16) produces perfectly regular patterns.

2. **kAnchorKMin direction**: To IMPROVE regularity, might need to INCREASE kAnchorKMin from 4 to 8 (16/4=4 vs 16/8=2 both give even gaps, but 8 has more hits). Or keep at 4 since 16/4=4 is already evenly divisible.

3. **Root cause investigation**: Why is stable zone regularity only 0.56 if euclidean patterns should be highly regular? The issue may be:
   - SHAPE variation within stable zone (syncopation/random contamination)
   - Shimmer/aux patterns reducing overall regularity
   - Regularity metric calculation issue

4. **Syncopation metric needs fixing**: Pattern length changed to 64 but metric weights are only 32. This needs to be addressed in a separate task.

## Evaluation

- Target metric: -1.2% (FAIL - wrong direction)
- Max regression: +4.8% voiceSeparation (already above target, worsened)
- Tests: PASS (after updating hardcoded values)

## Decision

**FAILED** - Target metric regressed instead of improving. Lever change reverted.

## Narration

This iteration attempted to improve stable zone regularity (0.56 vs target 0.72-1.00) using an ENERGY-domain lever (kAnchorKMin), correctly learning from iteration 2026-01-19-002's domain mismatch failure.

The hypothesis was that reducing kAnchorKMin from 4 to 3 would create sparser anchor patterns at low ENERGY, making patterns "simpler" and therefore more regular. A design-critic review validated the domain matching but cautioned about the weak evidence base.

When we ran evals, regularity actually decreased by 1.2%. The hypothesis was fundamentally flawed: regularity measures gap uniformity, not pattern sparseness. euclidean(16, 4) produces perfectly even 4-step gaps, while euclidean(16, 3) produces uneven gaps (5,5,6 steps).

The interesting secondary effect was that voice separation improved (+4.8%), suggesting sparser anchor patterns do create more complementary space for shimmer. This insight may be useful for voice separation goals.

**Key lesson**: Regularity ≠ sparseness. To improve regularity, we need patterns with uniform gap spacing. The real question is why stable zone patterns have 0.56 regularity when euclidean(16,4) should produce near-1.0 regularity. This suggests either SHAPE contamination (syncopation/random algorithms bleeding into stable zone) or a calculation issue.

For the next attempt, I recommend:
1. Investigate WHY stable zone has low regularity despite using euclidean
2. Check if SHAPE values vary within stable zone test patterns
3. Fix the syncopation metric bug (64-step patterns vs 32-step weights)

---

## Appendix: Code Changes

### algorithm_config.h

```diff
-constexpr int kAnchorKMin = 4;   ///< Minimum hits at ENERGY=0
+/// Iteration 2026-01-19-003: 4 → 3 to improve stable zone regularity
+constexpr int kAnchorKMin = 3;   ///< Minimum hits at ENERGY=0
```

### test_algorithm_weights.cpp

Updated hardcoded test values to use config constants:
- Lines 196-198: Use `AlgorithmConfig::kAnchorKMin` etc instead of literal 4
- Lines 204-206: Use `AlgorithmConfig::kAnchorKMax` etc instead of literal 12
- Lines 214-216: Calculate midpoint from config constants
- Lines 269-274: Use config constants for debug structure verification

These test changes are improvements regardless of whether the iteration succeeds.
