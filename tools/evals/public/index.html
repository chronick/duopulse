<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>DuoPulse v5 Pattern Evaluation</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div id="app">
    <header>
      <div class="header-top">
        <a href="../" class="back-link">&larr; DuoPulse Home</a>
      </div>
      <h1>DuoPulse v5 <span class="subtitle">Pattern Evaluation Dashboard</span></h1>
      <div class="voice-legend">
        <span class="legend-item v1">V1 (Anchor/Kick)</span>
        <span class="legend-item v2">V2 (Shimmer/Snare)</span>
        <span class="legend-item aux">AUX (Hat/Perc)</span>
      </div>
      <nav>
        <button class="nav-btn active" data-view="overview">Overview</button>
        <button class="nav-btn" data-view="presets">Presets</button>
        <button class="nav-btn" data-view="sweeps">Parameter Sweeps</button>
        <button class="nav-btn" data-view="seeds">Seed Variation</button>
        <button class="nav-btn" data-view="fills">Fills</button>
        <button class="nav-btn" data-view="iterations">Iterations</button>
      </nav>
    </header>

    <div class="app-layout">
      <main class="main-content">
        <!-- Loading state -->
        <div id="loading" class="loading">
          <div class="spinner"></div>
          <p>Loading pattern data...</p>
        </div>

        <!-- Error state -->
        <div id="error" class="error" hidden>
          <h2>Error Loading Data</h2>
          <p id="error-message"></p>
          <p class="hint">Run <code>make evals</code> to generate pattern data.</p>
        </div>

        <!-- Overview (Pentagon Summary) -->
        <section id="view-overview" class="view" hidden>
          <h2>Pattern Statistics & Pentagon of Musicality</h2>
          <div id="overview-container"></div>
        </section>

        <!-- Presets -->
        <section id="view-presets" class="view" hidden>
          <h2>Pattern Presets</h2>
          <p class="description">Click a pattern to load it into the player.</p>
          <div id="presets-container" class="presets-grid"></div>
        </section>

        <!-- Sweeps -->
        <section id="view-sweeps" class="view" hidden>
          <h2>Parameter Sweeps</h2>
          <p class="description">Click a pattern to load it into the player.</p>
          <div class="sweep-controls">
            <label>
              Parameter:
              <select id="sweep-select">
                <option value="shape">SHAPE</option>
                <option value="energy">ENERGY</option>
                <option value="axisX">AXIS X</option>
                <option value="axisY">AXIS Y</option>
                <option value="drift">DRIFT</option>
                <option value="accent">ACCENT</option>
              </select>
            </label>
          </div>
          <div id="sweep-container" class="sweep-grid"></div>
        </section>

        <!-- Seed Variation -->
        <section id="view-seeds" class="view" hidden>
          <h2>Seed Variation Analysis</h2>
          <p class="description">Pattern uniqueness across different random seeds.</p>
          <div id="seeds-summary"></div>
          <div id="seeds-container"></div>
        </section>

        <!-- Fills -->
        <section id="view-fills" class="view" hidden>
          <h2>Fill System Evaluation</h2>
          <p class="description">Fill pattern generation across energy levels and progress points.</p>
          <div id="fill-metrics-container"></div>
          <div class="fill-controls">
            <label>
              Energy Level:
              <select id="fill-energy-select"></select>
            </label>
          </div>
          <div id="fill-grid-container"></div>
        </section>

        <!-- Iterations -->
        <section id="view-iterations" class="view" hidden>
          <h2>Iteration History</h2>
          <p class="description">Track hill-climbing iterations and algorithm improvements over time.</p>

          <!-- Summary Statistics -->
          <div class="iteration-summary">
            <div class="stat-card">
              <div class="stat-value" id="stat-total">0</div>
              <div class="stat-label">Total Iterations</div>
            </div>
            <div class="stat-card success">
              <div class="stat-value" id="stat-success">0</div>
              <div class="stat-label">Successful</div>
            </div>
            <div class="stat-card failed">
              <div class="stat-value" id="stat-failed">0</div>
              <div class="stat-label">Failed</div>
            </div>
            <div class="stat-card">
              <div class="stat-value" id="stat-rate">0%</div>
              <div class="stat-label">Success Rate</div>
            </div>
          </div>

          <!-- Timeline Chart -->
          <div class="timeline-section">
            <h3>Metrics Progress Over Time</h3>
            <div id="iterations-timeline-chart"></div>
          </div>

          <!-- Filters and Search -->
          <div class="iteration-controls">
            <div class="search-box">
              <input type="search" id="search-iterations" placeholder="Search iterations..." />
            </div>
            <div class="filters">
              <label>
                Status:
                <select id="filter-status">
                  <option value="all">All</option>
                  <option value="success">Success</option>
                  <option value="failed">Failed</option>
                  <option value="pending">Pending</option>
                </select>
              </label>
              <label>
                Sort:
                <select id="sort-iterations">
                  <option value="newest">Newest First</option>
                  <option value="oldest">Oldest First</option>
                  <option value="impact">Highest Impact</option>
                </select>
              </label>
            </div>
          </div>

          <!-- Iteration Cards -->
          <div id="iterations-list"></div>
        </section>
      </main>

      <aside class="player-sidebar">
        <div id="player-container"></div>
      </aside>
    </div>

    <footer>
      <p>Generated <span id="gen-time">-</span> | <span id="num-patterns">-</span> patterns analyzed</p>
      <p class="hint">Keyboard: <kbd>Space</kbd> play/pause, <kbd>1</kbd><kbd>2</kbd><kbd>3</kbd> mute voices, <kbd>Esc</kbd> stop</p>
    </footer>
  </div>

  <script type="module" src="app.js"></script>
</body>
</html>
